<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'UsinaSoft' %></title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- UsinaSoft Custom CSS -->
    <link rel="stylesheet" href="/css/usinasoft-bootstrap.css">
</head>
<body class="login-page">
    <%- include('partials/header', { user: user, showNav: true, currentPage: 'atividades' }) %>
    
    <main class="main-content">
        <div class="container py-5">
            <!-- Page Header -->
            <div class="text-center mb-5">
                <h1 class="display-4 fw-bold text-usinasoft-primary mb-3">Controle de Atividades</h1>
                <p class="lead text-muted">Acompanhe o progresso das atividades em tempo real</p>
            </div>
            
            <!-- Kanban Board -->
            <div class="row g-4">
                <!-- Fila -->
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 fw-bold">Na Fila</h5>
                            <span class="badge bg-secondary"><%= atividades.fila.length %></span>
                        </div>
                        <div class="card-body p-3">
                            <div class="d-flex flex-column gap-3">
                                <% atividades.fila.forEach(atividade => { %>
                                    <div class="card border-start border-3 border-secondary" data-id="<%= atividade.id %>">
                                        <div class="card-body p-3">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <strong class="text-secondary"><%= atividade.codigo %></strong>
                                                <span class="badge bg-secondary">Fila</span>
                                            </div>
                                            <h6 class="card-title mb-2"><%= atividade.nome %></h6>
                                            <p class="card-text small text-muted mb-3">
                                                <strong>Data de Entrega:</strong> <%= atividade.dataEntrega %>
                                            </p>
                                            <div class="d-grid">
                                                <button class="btn btn-primary btn-sm" onclick="moverAtividade(<%= atividade.id %>, 'andamento')">
                                                    Iniciar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Em Andamento -->
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-warning d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 fw-bold">Em Andamento</h5>
                            <span class="badge bg-warning text-dark"><%= atividades.andamento.length %></span>
                        </div>
                        <div class="card-body p-3">
                            <div class="d-flex flex-column gap-3">
                                <% atividades.andamento.forEach(atividade => { %>
                                    <div class="card border-start border-3 border-warning" data-id="<%= atividade.id %>">
                                        <div class="card-body p-3">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <strong class="text-warning"><%= atividade.codigo %></strong>
                                                <span class="badge bg-warning text-dark">Andamento</span>
                                            </div>
                                            <h6 class="card-title mb-2"><%= atividade.nome %></h6>
                                            <p class="card-text small text-muted mb-3">
                                                <strong>Data de Entrega:</strong> <%= atividade.dataEntrega %>
                                            </p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-success btn-sm" onclick="moverAtividade(<%= atividade.id %>, 'concluido')">
                                                    Concluir
                                                </button>
                                                <button class="btn btn-outline-secondary btn-sm" onclick="moverAtividade(<%= atividade.id %>, 'fila')">
                                                    Voltar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Concluído -->
                <div class="col-lg-4 col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-success d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 fw-bold text-white">Concluído</h5>
                            <span class="badge bg-light text-success"><%= atividades.concluido.length %></span>
                        </div>
                        <div class="card-body p-3">
                            <div class="d-flex flex-column gap-3">
                                <% atividades.concluido.forEach(atividade => { %>
                                    <div class="card border-start border-3 border-success" data-id="<%= atividade.id %>">
                                        <div class="card-body p-3">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <strong class="text-success"><%= atividade.codigo %></strong>
                                                <span class="badge bg-success">Concluído</span>
                                            </div>
                                            <h6 class="card-title mb-2"><%= atividade.nome %></h6>
                                            <p class="card-text small text-muted mb-3">
                                                <strong>Data de Entrega:</strong> <%= atividade.dataEntrega %>
                                            </p>
                                            <div class="d-grid">
                                                <button class="btn btn-outline-danger btn-sm" onclick="removerAtividade(<%= atividade.id %>)">
                                                    Remover
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
    
    <%- include('partials/footer') %>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/main.js"></script>
    
    <script>
        function moverAtividade(id, novoStatus) {
            // Aqui você implementaria a lógica para mover a atividade
            console.log(`Movendo atividade ${id} para ${novoStatus}`);
            // Por enquanto, apenas recarrega a página
            location.reload();
        }

        function removerAtividade(id) {
            if (confirm('Tem certeza que deseja remover esta atividade?')) {
                // Aqui você implementaria a lógica para remover a atividade
                console.log(`Removendo atividade ${id}`);
                // Por enquanto, apenas recarrega a página
                location.reload();
            }
        }
    </script>
</body>
</html>
